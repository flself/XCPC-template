# 字符串

## KMP

> 可以尝试从 $fail$ 树的角度理解

```cpp

bool kmp(string &s, string &p) {
    int n = p.size();
    vector<int> nex(n + 1);
    for (int i = 1, l = 0; i < n; ++i) {
        while (l && p[l] != p[i]) {l = nex[l];}
        if (p[l] != p[i]) nex[i] = 0;
        else nex[i] = ++l;
    }
    n = s.size();
    for (int i = 0, now = 0; i < n; ++i) {
        while (now && s[i] != p[now]) now = nex[now - 1];
        if (s[i] == p[now]) ++now;
        if (now == p.size()) return true;
    }
    return false;
}
```

## 后缀自动机

![后缀自动机图解](assets/sam.png)

```cpp

struct SuffixAutomaton {
    static constexpr int ALPHABET_SIZE = 26;
    int N = 1e5;
    struct Node {
        int len;
        int link;
        // int next[ALPHABET_SIZE];
        std::vector<int> next;
        Node() : len(0), link(0), next(ALPHABET_SIZE) {}
    };
    std::vector<Node> t;
    int cntNodes;
    int extend(int p, int c) {
        if (t[p].next[c]) {
            int q = t[p].next[c];
            if (t[q].len == t[p].len + 1)
                return q;
            int r = ++cntNodes;
            t[r].len = t[p].len + 1;
            t[r].link = t[q].link;
            // std::copy(t[q].next, t[q].next + ALPHABET_SIZE, t[r].next);
            t[r].next = t[q].next;
            t[q].link = r;
            while (t[p].next[c] == q) {
                t[p].next[c] = r;
                p = t[p].link;
            }
            return r;
        }
        int cur = ++cntNodes;
        t[cur].len = t[p].len + 1;
        while (!t[p].next[c]) {
            t[p].next[c] = cur;
            p = t[p].link;
        }
        t[cur].link = extend(p, c);
        return cur;
    }
    SuffixAutomaton(int N_): t(2 * N_), N(N_) {
        cntNodes = 1;
        // std::fill(t[0].next, t[0].next + ALPHABET_SIZE, 1);
        t[0].next.assign(ALPHABET_SIZE, 1);
        t[0].len = -1;
    }
    SuffixAutomaton(string s): t(2 * s.size()), N(s.size()) {
        cntNodes = 1;
        t[0].next.assign(ALPHABET_SIZE, 1);
        t[0].len = -1;

        int p = 1;
        for (auto ch: s) {
            p = extend(p, ch-'a');
        }
    }
};
```
